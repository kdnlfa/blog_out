"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{1056:(e,t,r)=>{r.d(t,{EJ:()=>g,R2:()=>u,lR:()=>l,lW:()=>h,qs:()=>d});let a=r(9509).env.NEXT_PUBLIC_API_URL||"https://xzatkvsdyvij.sealosbja.site",s={login:"".concat(a,"/api/auth/login"),register:"".concat(a,"/api/auth/register"),me:"".concat(a,"/api/auth/me"),updateProfile:"".concat(a,"/api/auth/profile"),changePassword:"".concat(a,"/api/auth/password"),logout:"".concat(a,"/api/auth/logout"),verify:"".concat(a,"/api/auth/verify")},i="blog_auth_user",n="blog_auth_token";class l extends Error{constructor(e,t,r){super(t),this.code=e,this.field=r,this.name="AuthError"}}class o{getAuthHeaders(){let e=localStorage.getItem(n);return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let i=await fetch(e,{...t,headers:{...this.getAuthHeaders(),...t.headers}}),n=await i.json();if(!n.success){var r,a,s;throw new l((null==(r=n.error)?void 0:r.code)||"API_ERROR",(null==(a=n.error)?void 0:a.message)||n.message||"请求失败",null==(s=n.error)?void 0:s.field)}return n.data}catch(e){if(e instanceof l)throw e;throw new l("NETWORK_ERROR","网络连接失败，请检查后端服务是否启动")}}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async get(e){return this.request(e,{method:"GET"})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}}let c=new o,u={login:async e=>await c.post(s.login,e),async register(e){let{confirmPassword:t,...r}=e;return await c.post(s.register,r)},async logout(){try{await c.post(s.logout)}catch(e){console.warn("Logout API failed, but clearing local storage:",e)}},async getCurrentUser(){if(!localStorage.getItem(n))return null;try{return await c.get(s.me)}catch(e){return localStorage.removeItem(n),localStorage.removeItem(i),null}},async updateProfile(e,t){let r={displayName:t.displayName,bio:t.bio,avatar:t.avatar};return await c.put(s.updateProfile,r)},async changePassword(e,t,r){await c.put(s.changePassword,{oldPassword:t,newPassword:r})},async verifyToken(){if(!localStorage.getItem(n))return!1;try{return await c.get(s.verify),!0}catch(e){return!1}}},d={saveUser(e,t){localStorage.setItem(i,JSON.stringify(e)),localStorage.setItem(n,t)},getUser(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):null}catch(e){return null}},getToken:()=>localStorage.getItem(n),clearUser(){localStorage.removeItem(i),localStorage.removeItem(n)}},g={validateEmail:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"请输入有效的邮箱地址":"请输入邮箱地址",validatePassword:e=>e?e.length<6?"密码至少需要6个字符":null:"请输入密码",validateUsername:e=>e?e.length<3?"用户名至少需要3个字符":/^[a-zA-Z0-9_]+$/.test(e)?null:"用户名只能包含字母、数字和下划线":"请输入用户名",validateDisplayName:e=>e?e.length<2?"显示名称至少需要2个字符":e.length>50?"显示名称不能超过50个字符":null:"请输入显示名称",validatePasswordConfirm:(e,t)=>t?e!==t?"两次输入的密码不一致":null:"请确认密码"},h={isAdmin:e=>(null==e?void 0:e.role)==="ADMIN",canEdit:e=>(null==e?void 0:e.role)==="ADMIN"||(null==e?void 0:e.role)==="EDITOR",canAccessProfile(e,t){return(null==e?void 0:e.id)===t||this.isAdmin(e)}}},3274:(e,t,r)=>{r.d(t,{As:()=>o,AuthProvider:()=>l,Nu:()=>c});var a=r(5155),s=r(2115),i=r(1056);let n=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)({user:null,isLoading:!0,isAuthenticated:!1}),[o,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{l(e=>({...e,isLoading:!0}));let e=i.qs.getUser(),t=i.qs.getToken();if(e&&t){let e=await i.R2.getCurrentUser();if(e)return void l({user:e,isLoading:!1,isAuthenticated:!0})}i.qs.clearUser(),l({user:null,isLoading:!1,isAuthenticated:!1})}catch(e){console.error("初始化认证状态失败:",e),i.qs.clearUser(),l({user:null,isLoading:!1,isAuthenticated:!1})}},d=async e=>{try{l(e=>({...e,isLoading:!0})),c(null);let{user:t,token:r}=await i.R2.login(e);i.qs.saveUser(t,r),l({user:t,isLoading:!1,isAuthenticated:!0})}catch(e){throw l(e=>({...e,isLoading:!1})),e instanceof i.lR?c(e):c(new i.lR("UNKNOWN_ERROR","登录失败，请重试")),e}},g=async e=>{try{l(e=>({...e,isLoading:!0})),c(null);let{user:t,token:r}=await i.R2.register(e);i.qs.saveUser(t,r),l({user:t,isLoading:!1,isAuthenticated:!0})}catch(e){throw l(e=>({...e,isLoading:!1})),e instanceof i.lR?c(e):c(new i.lR("UNKNOWN_ERROR","注册失败，请重试")),e}},h=async()=>{try{l(e=>({...e,isLoading:!0})),await i.R2.logout(),i.qs.clearUser(),l({user:null,isLoading:!1,isAuthenticated:!1}),c(null)}catch(e){console.error("退出登录失败:",e),i.qs.clearUser(),l({user:null,isLoading:!1,isAuthenticated:!1})}},f=async e=>{if(!r.user)throw new i.lR("NOT_AUTHENTICATED","请先登录");try{l(e=>({...e,isLoading:!0})),c(null);let t=await i.R2.updateProfile(r.user.id,e),a=i.qs.getToken();a&&i.qs.saveUser(t,a),l(e=>({...e,user:t,isLoading:!1}))}catch(e){throw l(e=>({...e,isLoading:!1})),e instanceof i.lR?c(e):c(new i.lR("UPDATE_FAILED","更新资料失败，请重试")),e}},v=async(e,t)=>{if(!r.user)throw new i.lR("NOT_AUTHENTICATED","请先登录");try{l(e=>({...e,isLoading:!0})),c(null),await i.R2.changePassword(r.user.id,e,t),l(e=>({...e,isLoading:!1}))}catch(e){throw l(e=>({...e,isLoading:!1})),e instanceof i.lR?c(e):c(new i.lR("PASSWORD_CHANGE_FAILED","修改密码失败，请重试")),e}},y={...r,login:d,register:g,logout:h,updateProfile:f,changePassword:v,error:o,clearError:()=>{c(null)}};return(0,a.jsx)(n.Provider,{value:y,children:t})}function o(){let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=o();return(0,s.useEffect)(()=>{e.isLoading||e.isAuthenticated||console.warn("用户未登录，需要登录后访问")},[e.isLoading,e.isAuthenticated]),e}},3999:(e,t,r)=>{r.d(t,{cn:()=>i});var a=r(2596),s=r(9688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},4912:(e,t,r)=>{r.d(t,{$n:()=>c,Qi:()=>h,jn:()=>u,k7:()=>f,rp:()=>g,tA:()=>d});var a=r(5155),s=r(2115),i=r(2085),n=r(3999);let l=(0,i.F)("inline-flex items-center justify-center rounded-md font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-500",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 focus-visible:ring-gray-500",outline:"border border-gray-300 bg-transparent text-gray-700 hover:bg-gray-50 focus-visible:ring-gray-500",ghost:"text-gray-600 hover:bg-gray-100 hover:text-gray-900 focus-visible:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus-visible:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus-visible:ring-green-500"},size:{xs:"h-7 px-2 text-xs",sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-6 text-base",xl:"h-12 px-8 text-lg"},fullWidth:{true:"w-full",false:"w-auto"}},defaultVariants:{variant:"primary",size:"md",fullWidth:!1}}),o=e=>{let{className:t}=e;return(0,a.jsxs)("svg",{className:(0,n.cn)("animate-spin",t),viewBox:"0 0 24 24",fill:"none",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"m12 2c5.523 0 10 4.477 10 10h-4c0-3.313-2.687-6-6-6v-4z"})]})},c=(0,s.forwardRef)((e,t)=>{let{className:r,variant:s,size:i,fullWidth:c,loading:u=!1,disabled:d,children:g,leftIcon:h,rightIcon:f,...v}=e;return(0,a.jsxs)("button",{ref:t,className:(0,n.cn)(l({variant:s,size:i,fullWidth:c}),r),disabled:d||u,...v,children:[u?(0,a.jsx)(o,{className:"mr-2 h-4 w-4"}):h?(0,a.jsx)("span",{className:"mr-2",children:h}):null,(0,a.jsx)("span",{children:g}),f&&!u&&(0,a.jsx)("span",{className:"ml-2",children:f})]})});c.displayName="Button";let u=(0,s.forwardRef)((e,t)=>(0,a.jsx)(c,{ref:t,variant:"primary",...e})),d=(0,s.forwardRef)((e,t)=>(0,a.jsx)(c,{ref:t,variant:"secondary",...e})),g=(0,s.forwardRef)((e,t)=>(0,a.jsx)(c,{ref:t,variant:"outline",...e})),h=(0,s.forwardRef)((e,t)=>(0,a.jsx)(c,{ref:t,variant:"danger",...e})),f=(0,s.forwardRef)((e,t)=>(0,a.jsx)(c,{ref:t,variant:"success",...e}))}}]);