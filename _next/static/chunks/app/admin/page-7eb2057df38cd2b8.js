(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{1202:(e,s,t)=>{"use strict";t.d(s,{BT:()=>h,N:()=>g,Tn:()=>u,Wu:()=>x,ZB:()=>o,Zj:()=>p,Zp:()=>n,aR:()=>d,vZ:()=>j,wL:()=>m});var r=t(5155),a=t(2115),l=t(2085),i=t(3999);let c=(0,l.F)("rounded-lg bg-white transition-all duration-200",{variants:{shadow:{none:"",sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg",xl:"shadow-xl"},padding:{none:"",sm:"p-3",md:"p-4",lg:"p-6",xl:"p-8"},border:{true:"border border-gray-200",false:""},hover:{true:"hover:shadow-lg hover:scale-[1.02] cursor-pointer",false:""}},defaultVariants:{shadow:"md",padding:"md",border:!1,hover:!1}}),n=(0,a.forwardRef)((e,s)=>{let{className:t,shadow:a,padding:l,border:n,hover:d,children:o,...h}=e;return(0,r.jsx)("div",{ref:s,className:(0,i.cn)(c({shadow:a,padding:l,border:n,hover:d}),t),...h,children:o})});n.displayName="Card";let d=(0,a.forwardRef)((e,s)=>{let{className:t,children:a,...l}=e;return(0,r.jsx)("div",{ref:s,className:(0,i.cn)("mb-4",t),...l,children:a})});d.displayName="CardHeader";let o=(0,a.forwardRef)((e,s)=>{let{className:t,children:a,as:l="h3",...c}=e;return(0,r.jsx)(l,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight text-gray-900",t),...c,children:a})});o.displayName="CardTitle";let h=(0,a.forwardRef)((e,s)=>{let{className:t,children:a,...l}=e;return(0,r.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-gray-600 mt-1",t),...l,children:a})});h.displayName="CardDescription";let x=(0,a.forwardRef)((e,s)=>{let{className:t,children:a,...l}=e;return(0,r.jsx)("div",{ref:s,className:(0,i.cn)("",t),...l,children:a})});x.displayName="CardContent";let m=(0,a.forwardRef)((e,s)=>{let{className:t,children:a,...l}=e;return(0,r.jsx)("div",{ref:s,className:(0,i.cn)("mt-4 pt-4 border-t border-gray-100",t),...l,children:a})});m.displayName="CardFooter";let u=(0,a.forwardRef)((e,s)=>(0,r.jsx)(n,{ref:s,shadow:"sm",border:!0,...e})),g=(0,a.forwardRef)((e,s)=>(0,r.jsx)(n,{ref:s,shadow:"lg",...e})),j=(0,a.forwardRef)((e,s)=>(0,r.jsx)(n,{ref:s,hover:!0,...e})),p=(0,a.forwardRef)((e,s)=>{let{title:t,excerpt:a,author:l,date:c,category:u,tags:g=[],imageUrl:j,href:p,onRead:y,className:f,...v}=e;return(0,r.jsxs)(n,{ref:s,hover:!!(y||p),className:(0,i.cn)("overflow-hidden",f),onClick:()=>{y?y():p&&window.open(p,"_self")},...v,children:[j&&(0,r.jsx)("div",{className:"aspect-video relative overflow-hidden",children:(0,r.jsx)("img",{src:j,alt:t,className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:(0,i.cn)(j?"p-4":""),children:[(0,r.jsxs)(d,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:u}),(0,r.jsx)("span",{className:"text-gray-500 text-xs",children:c})]}),(0,r.jsx)(o,{children:t}),(0,r.jsx)(h,{children:a})]}),(0,r.jsx)(x,{children:g.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[g.slice(0,3).map((e,s)=>(0,r.jsxs)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["#",e]},s)),g.length>3&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["+",g.length-3]})]})}),(0,r.jsx)(m,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["作者: ",l]}),(0,r.jsx)("span",{className:"text-blue-600 text-sm font-medium",children:"阅读更多 →"})]})})]})]})});p.displayName="BlogCard"},2868:(e,s,t)=>{"use strict";t.d(s,{$Q:()=>l,Iw:()=>d,cI:()=>n});let r=t(9509).env.NEXT_PUBLIC_API_URL||"https://xzatkvsdyvij.sealosbja.site",a={articles:"".concat(r,"/api/articles"),categories:"".concat(r,"/api/articles/categories"),tags:"".concat(r,"/api/articles/tags"),articleById:e=>"".concat(r,"/api/articles/").concat(e),articleBySlug:e=>"".concat(r,"/api/articles/slug/").concat(e),articlesByAuthor:e=>"".concat(r,"/api/articles/author/").concat(e),likeArticle:e=>"".concat(r,"/api/articles/").concat(e,"/like")};class l extends Error{constructor(e,s,t){super(s),this.code=e,this.field=t,this.name="ArticleApiError"}}class i{getAuthHeaders(){let e=localStorage.getItem("blog_auth_token");return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let i=await fetch(e,{...s,headers:{...this.getAuthHeaders(),...s.headers}}),c=await i.json();if(!c.success){var t,r,a;throw new l((null==(t=c.error)?void 0:t.code)||"API_ERROR",(null==(r=c.error)?void 0:r.message)||c.message||"请求失败",null==(a=c.error)?void 0:a.field)}return c.data}catch(e){if(e instanceof l)throw e;throw new l("NETWORK_ERROR","网络连接失败，请检查后端服务是否启动")}}async get(e){return this.request(e,{method:"GET"})}async post(e,s){return this.request(e,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(e,s){return this.request(e,{method:"PUT",body:s?JSON.stringify(s):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}let c=new i,n={async getArticles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new URLSearchParams;Object.entries(e).forEach(e=>{let[t,r]=e;null!=r&&(Array.isArray(r)?s.append(t,r.join(",")):s.append(t,String(r)))});let t=s.toString()?"".concat(a.articles,"?").concat(s):a.articles;return c.get(t)},getArticleById:async e=>c.get(a.articleById(e)),getArticleBySlug:async e=>c.get(a.articleBySlug(e)),createArticle:async e=>c.post(a.articles,e),updateArticle:async(e,s)=>c.put(a.articleById(e),s),deleteArticle:async e=>c.delete(a.articleById(e)),getCategories:async()=>c.get(a.categories),getTags:async()=>c.get(a.tags),async getArticlesByAuthor(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=new URLSearchParams;Object.entries(s).forEach(e=>{let[s,r]=e;null!=r&&(Array.isArray(r)?t.append(s,r.join(",")):t.append(s,String(r)))});let r=t.toString()?"".concat(a.articlesByAuthor(e),"?").concat(t):a.articlesByAuthor(e);return c.get(r)},likeArticle:async e=>c.post(a.likeArticle(e))},d={parseTags(e){try{return JSON.parse(e)}catch(e){return[]}},formatDate:e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),generateExcerpt(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150,t=e.replace(/#{1,6}\s/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/\[([^\]]*)\]\([^)]*\)/g,"$1").replace(/!\[([^\]]*)\]\([^)]*\)/g,"").replace(/\n+/g," ").trim();return t.length>s?t.substring(0,s)+"...":t},calculateReadTime(e){let s=Math.ceil(e.length/200);return"".concat(s,"分钟")}}},5695:(e,s,t)=>{"use strict";var r=t(8999);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},7161:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var r=t(5155),a=t(2115),l=t(5695),i=t(6874),c=t.n(i),n=t(3343),d=t(4912),o=t(1202),h=t(8145),x=t(3274),m=t(2868),u=t(1056);function g(){let e=(0,l.useRouter)(),{user:s,isAuthenticated:t}=(0,x.As)(),[i,g]=(0,a.useState)([]),[j,p]=(0,a.useState)(!0),[y,f]=(0,a.useState)(null),[v,N]=(0,a.useState)(null),[b,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&(null==s?void 0:s.id)&&A()},[t,s]);let A=async()=>{try{let e;p(!0),f(null),e=u.lW.isAdmin(s)?await m.cI.getArticles({sortBy:"createdAt",sortOrder:"desc"}):await m.cI.getArticlesByAuthor((null==s?void 0:s.id)||"",{sortBy:"createdAt",sortOrder:"desc"}),g(e.articles)}catch(e){console.error("获取文章列表失败:",e),e instanceof m.$Q?f(e.message):f("获取文章列表失败")}finally{p(!1)}},R=async e=>{try{w(!0),await m.cI.deleteArticle(e),g(s=>s.filter(s=>s.id!==e)),N(null),alert("文章删除成功")}catch(e){console.error("删除文章失败:",e),e instanceof m.$Q?alert("删除失败："+e.message):alert("删除文章失败")}finally{w(!1)}};return t?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(n.default,{}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"文章管理"}),(0,r.jsx)("p",{className:"text-gray-600",children:u.lW.isAdmin(s)?"管理所有用户的文章":"管理你的所有文章"})]}),(0,r.jsx)(c(),{href:"/admin/create",children:(0,r.jsx)(d.$n,{children:"写新文章"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:i.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"总文章数"})]})})}),(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:i.filter(e=>e.isPublished).length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"已发布"})]})})}),(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:i.filter(e=>!e.isPublished).length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"草稿"})]})})})]}),(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{children:(0,r.jsx)(o.ZB,{children:u.lW.isAdmin(s)?"所有文章":"我的文章"})}),(0,r.jsx)(o.Wu,{children:j?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("div",{className:"text-gray-600",children:"加载中..."})}):y?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"text-red-600 mb-4",children:y}),(0,r.jsx)(d.$n,{onClick:A,variant:"outline",children:"重试"})]}):0===i.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"还没有文章"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"开始写你的第一篇文章吧！"}),(0,r.jsx)(c(),{href:"/admin/create",children:(0,r.jsx)(d.$n,{children:"写新文章"})})]}):(0,r.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,r.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,r.jsx)(h.E,{variant:e.isPublished?"default":"secondary",children:e.isPublished?"已发布":"草稿"})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:m.Iw.generateExcerpt(e.content,120)}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[u.lW.isAdmin(s)&&(0,r.jsxs)("span",{children:["作者: ",e.author.displayName]}),(0,r.jsxs)("span",{children:["分类: ",e.category]}),(0,r.jsxs)("span",{children:["标签: ",Array.isArray(e.tags)&&e.tags.length>0?e.tags.join(", "):"无标签"]}),(0,r.jsxs)("span",{children:["创建时间: ",m.Iw.formatDate(e.createdAt)]}),(0,r.jsxs)("span",{children:["阅读: ",e.viewCount]}),(0,r.jsxs)("span",{children:["点赞: ",e.likeCount]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,r.jsx)(c(),{href:"/blog/".concat(e.slug),children:(0,r.jsx)(d.$n,{variant:"outline",size:"sm",children:"查看"})}),(u.lW.isAdmin(s)||e.author.id===(null==s?void 0:s.id))&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.$n,{variant:"outline",size:"sm",children:"编辑"}),(0,r.jsx)(d.$n,{variant:"outline",size:"sm",onClick:()=>N(e.id),className:"text-red-600 hover:text-red-700",children:"删除"})]})]})]})},e.id))})})]}),v&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"确认删除文章"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"删除后无法恢复，你确定要删除这篇文章吗？"}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)(d.$n,{variant:"outline",onClick:()=>N(null),disabled:b,children:"取消"}),(0,r.jsx)(d.$n,{onClick:()=>R(v),disabled:b,className:"bg-red-600 hover:bg-red-700",children:b?"删除中...":"确认删除"})]})]})})]})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(n.default,{}),(0,r.jsx)("div",{className:"max-w-4xl mx-auto py-12 px-4",children:(0,r.jsx)(o.Zp,{children:(0,r.jsxs)(o.Wu,{className:"pt-6 text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"需要登录"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"请先登录才能管理文章"}),(0,r.jsx)(d.$n,{onClick:()=>e.push("/auth/login"),children:"前往登录"})]})})})]})}},7673:(e,s,t)=>{Promise.resolve().then(t.bind(t,7161))}},e=>{var s=s=>e(e.s=s);e.O(0,[490,7,343,441,684,358],()=>s(7673)),_N_E=e.O()}]);